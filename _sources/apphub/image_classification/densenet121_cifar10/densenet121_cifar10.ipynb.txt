{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Cifar10 Image Classification Using DenseNet-121\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Basic import "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import tensorflow as tf\n",
    "import fastestimator as fe\n",
    "import matplotlib.pyplot as plt\n",
    "import numpy as np"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step1: Create FastEstimator `Pipeline`\n",
    "### Load Dataset \n",
    "First, we load the training and evaluation dataset into memory use keras API.\n",
    "   "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "train image shape is (50000, 32, 32, 3)\n",
      "train label shape is (50000, 1)\n",
      "eval image shape is (10000, 32, 32, 3)\n",
      "eval label shape is (10000, 1)\n"
     ]
    }
   ],
   "source": [
    "(x_train, y_train), (x_eval, y_eval) = tf.keras.datasets.cifar10.load_data()\n",
    "print(\"train image shape is {}\".format(x_train.shape))\n",
    "print(\"train label shape is {}\".format(y_train.shape))\n",
    "print(\"eval image shape is {}\".format(x_eval.shape))\n",
    "print(\"eval label shape is {}\".format(y_eval.shape))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Define `Pipeline`\n",
    "`Pipeline` is the object that define how the training and evaulation data being ingested to the network.\n",
    "It has three basic arguments: \n",
    "* **batch_size**: (int) The batch size \n",
    "* **data**: (dict) the data source. It should be the nested dictionary like {\"mode1\": {\"feature1\": numpy_array, \"feature2\": numpy_array, ...}, ...} \n",
    "* **ops**: (list, obj) The list of pipeline processs block. For this example, we only use Minmax, so it can be the object.  "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "from fastestimator.pipeline.processing import Minmax\n",
    "batch_size = 64\n",
    "data = {\"train\": {\"x\": x_train, \n",
    "                  \"y\": y_train}, \n",
    "        \"eval\": {\"x\": x_eval, \n",
    "                 \"y\": y_eval}}\n",
    "\n",
    "pipeline = fe.Pipeline(batch_size=batch_size, data=data, ops=Minmax(inputs=\"x\", outputs=\"x2\"))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Validate The Input Pipeline\n",
    "Once the pipeline was created, it is better to validate it with pipeline method, **show_results**, which will return a sample batch of pipeline data that give you a clue of how it works.  \n",
    "\n",
    "Because the pipeline has two different modes, \"train\" and \"eval\", we can take a looks of both examples."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "the shape of train image batch is (64, 32, 32, 3)\n",
      "the shape of train label batch is (64, 1)\n",
      "the shape of eval image batch is (64, 32, 32, 3)\n",
      "the shape of eval label batch is (64, 1)\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 2 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "fig, ax = plt.subplots(1,2)\n",
    "train_sample = pipeline.show_results(mode=\"train\")\n",
    "print(\"the shape of train image batch is {}\".format(train_sample[0][\"x\"].numpy().shape))\n",
    "print(\"the shape of train label batch is {}\".format(train_sample[0][\"y\"].numpy().shape))\n",
    "ax[0].imshow(train_sample[0][\"x\"].numpy()[0])\n",
    "ax[0].set_title(\"the first image in train batch\")\n",
    "                \n",
    "eval_sample = pipeline.show_results(mode=\"eval\")\n",
    "print(\"the shape of eval image batch is {}\".format(eval_sample[0][\"x\"].numpy().shape))\n",
    "print(\"the shape of eval label batch is {}\".format(eval_sample[0][\"y\"].numpy().shape))\n",
    "ax[1].imshow(eval_sample[0][\"x\"].numpy()[0])\n",
    "ax[1].set_title(\"the first image in eval batch\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Validate The Pipeline Output\n",
    "There are totally three keys in the pipeline \n",
    "1. \"y\": the label\n",
    "2. \"x\": the input image \n",
    "3. \"x2\": the processed output image.\n",
    "In the previous example we only validate the input image. We still need to validate the processed output image, since it will be the actual input data source for the network after all. <br/>\n",
    "\n",
    "The image process chain only has Minmax operation, which will map the minimum pixel value to 0 and maximum to 1."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "In train_sample[\"x\"] the max is 255, the min is 0\n",
      "In train_sample[\"x2\"] the max is 1.0, the min is 0.0\n",
      "In eval_sample[\"x\"] the max is 255, the min is 0\n",
      "In eval_sample[\"x2\"] the max is 1.0, the min is 0.0\n"
     ]
    }
   ],
   "source": [
    "print(\"In train_sample[\\\"x\\\"] the max is {}, the min is {}\".format(np.max(train_sample[0][\"x\"].numpy()), np.min(train_sample[0][\"x\"].numpy())))\n",
    "print(\"In train_sample[\\\"x2\\\"] the max is {}, the min is {}\".format(np.max(train_sample[0][\"x2\"].numpy()), np.min(train_sample[0][\"x2\"].numpy())))\n",
    "print(\"In eval_sample[\\\"x\\\"] the max is {}, the min is {}\".format(np.max(eval_sample[0][\"x\"].numpy()), np.min(eval_sample[0][\"x\"].numpy())))\n",
    "print(\"In eval_sample[\\\"x2\\\"] the max is {}, the min is {}\".format(np.max(eval_sample[0][\"x2\"].numpy()), np.min(eval_sample[0][\"x2\"].numpy())))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step2: Create FastEstimator `Network` \n",
    "`Network` is the object that define the whole logic of neural network, including models, loss functions, optimizers ... etc. \n",
    "A Network can have several different models and loss funcitons (like GAN), but in this case, we are going to build a single model network.   \n",
    "\n",
    "### Define Keras Model Function\n",
    "The Model architecture of Fastestimator is defined by Tensorflow API (Keras). Here we used the pre-defined Keras function for building DensNet-121, and follow it by the custom layer to make it fit the Cifar10 dataset.   \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "from tensorflow.keras.applications.densenet import DenseNet121 \n",
    "from tensorflow.keras.layers import Dense, Input\n",
    "\n",
    "def DenseNet121_cifar10():\n",
    "    inputs = Input((32,32,3))\n",
    "    x = DenseNet121(weights=None, input_shape=(32,32,3), include_top=False, pooling='avg')(inputs)\n",
    "    outputs = Dense(10, activation='softmax')(x)\n",
    "    model = tf.keras.Model(inputs=inputs, outputs=outputs)\n",
    "    return model"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Define `FEModel` from Keras\n",
    "Here We build `FEModel` from Keras model function. It has four arguments:\n",
    "* **model_def**: The model definition function.\n",
    "* **model_name**: The name of the model. It will be used when storing the model. \n",
    "* **optimizer**: The optimizer. It can either be str or tf.optimizers object. \n",
    "* **loss_name**: The name of the loss. Pleas be aware it is the dictionary key name and will be used in `Network` definition.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "from fastestimator.network.model import FEModel, ModelOp\n",
    "from fastestimator.network.loss import SparseCategoricalCrossentropy\n",
    "\n",
    "model = FEModel(model_def=DenseNet121_cifar10, \n",
    "                model_name=\"densenet121\", \n",
    "                optimizer=tf.optimizers.Adam(lr=0.1), \n",
    "                loss_name=\"loss\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Define `Network` from `FEMode`\n",
    "So far we already have `FEmodel` and `Pipeline`, but how those networks connect to each other is still not defined yet.\n",
    "`Network` API is created for this reason. Its input argument is a list of operations each have IO \"keys\". By sharing the keys, those operations can connect in the way you like."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "network = fe.Network(ops=[\n",
    "    ModelOp(inputs=\"x2\", model=model, outputs=\"y_pred\"), \n",
    "    SparseCategoricalCrossentropy(y_true=\"y\", y_pred=\"y_pred\", outputs=\"loss\"),\n",
    "])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The network will connect like the following graph \n",
    "<img src=\"network_workflow.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 3: Create `Estimator` \n",
    "`Estimator` is the APi that wrap up the `Pipeline`, `Network` and other training metadata together.\n",
    "The `Estimator` basically have 4 arguments:\n",
    "* **pipeline**: the pipeline\n",
    "* **network** the network\n",
    "* **epoch** the epoch number of training\n",
    "* **traces** the list of `trace` object. They are pretty like the callbacks of Keras. The trace object will be called on specific timing during the training. Here we used **Accuracy** for getting model accuracy, **ModelSaver** for saving the best model checkpoint, and **LRController** for adapting learning rate. \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [],
   "source": [
    "import tempfile.mkdtemp()\n",
    "from fastestimator.estimator.trace import Accuracy, ModelSaver, LRController, TensorBoard\n",
    "\n",
    "save_dir = tempfile.mkdtemp()\n",
    "\n",
    "estimator = fe.Estimator(\n",
    "    network=network,\n",
    "    pipeline=pipeline,\n",
    "    epochs=50,\n",
    "    traces=[\n",
    "        Accuracy(true_key=\"y\", pred_key=\"y_pred\"),\n",
    "        ModelSaver(model_name=\"densenet121\", save_dir=save_dir, save_best=True),\n",
    "        LRController(model_name=\"densenet121\", reduce_on_eval=True)\n",
    "    ])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Start Training\n",
    "We use `Estimator` method **fit** to train the model. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "estimator.fit()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Validate Model\n",
    "After we trained the model, we might want to validate the model by running inference on evaluation datasets. Because FE so far doesn't support doing inference using estimator, We ues Keras API. \n",
    "\n",
    "First load the keras model (storing by **ModelSaver**)     "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "model_path = os.path.join(save_dir, 'densenet121_best_loss.h5')\n",
    "trained_model = tf.keras.models.load_model(model_path, compile=False)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because the keras model doesn't include the data preprocessing pipeline, we cannot ingest the raw dataset to the model. Instead, we need to create the same pipeline again with batch size equal to whole evaluation dataset and feed the processed to the keras model. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "the evaluation accuracy is 0.7518\n"
     ]
    }
   ],
   "source": [
    "pipeline = fe.Pipeline(batch_size=10000, data=data, ops=Minmax(inputs=\"x\", outputs=\"x2\"))\n",
    "eval_sample = pipeline.show_results(mode=\"eval\")\n",
    "x_input = eval_sample[0][\"x2\"].numpy()\n",
    "y_input = eval_sample[0][\"y\"].numpy()\n",
    "y_output = trained_model.predict(x_input)\n",
    "y_predict = np.argmax(y_output, axis=1).reshape(10000,1)\n",
    "print(\"the evaluation accuracy is {}\".format(np.count_nonzero((y_input == y_predict))/10000))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's have a look as a random inference sample"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "the ground truth label is [1], and the prediction is [1]\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "rand_int = np.random.randint(10000)\n",
    "fig, ax = plt.subplots()\n",
    "ax.imshow(x_input[rand_int])\n",
    "ax.set_title(\"the input image\")\n",
    "print(\"the ground truth label is {}, and the prediction is {}\".format(y_input[rand_int], y_predict[rand_int]))"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
